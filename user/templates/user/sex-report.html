{% extends 'user/layouts/master.html' %}
{% block content %}
{% load static %}

<!-- side bar -->
<!-- side bar -->
<div id="sidebar" class="active">
    <div class="sidebar-wrapper active ps ps--active-y">
        <div class="sidebar-header">
            <div class="justify-content-between">
                <div class="logo mb-3 text-center">
                    {% comment %} <img src="{{user.member.img.url }}" class="myimg" /> {% endcomment %}
                    <img src="{% static 'images/logo/logooo.png' %}" style="width:auto; height:200px"alt="Logo">
                </div>
                <div class="toggler">
                    <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                </div>
            </div>
        </div>
        <div class="sidebar-menu">
            <ul class="menu">
                <li class="sidebar-title">Menu</li>

                <li class="sidebar-item">
                    <a href="{% url 'dashboard' %}" class="sidebar-link">
                        <i class="bi bi-grid-fill"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
{% if user.is_staff %}
                <li class="sidebar-item has-sub">
                    <a href="#" class="sidebar-link">
                        <i class="bi bi-people-fill"></i>
                        <span>Members</span>
                    </a>
                    <ul class="submenu" style="display: none;">
                        <li class="submenu-item">
                            <a href="{% url 'add-member' %}">Add Member</a>
                        </li>
                        
                        <li class="submenu-item">
                            <a href="{% url 'all-members' %}">All Members</a>
                        </li>
                        <li class="submenu-item">
                            <a href="{% url 'member-requests' %}">Member Requests</a>
                        </li>
                        <li class="submenu-item">
                            <a href="{% url 'manage-members' %}">Manage Members</a>
                        </li>
                    </ul>
                </li>
{% endif %}
{% if user.is_superuser %}
                <li class="sidebar-item has-sub">
                    <a href="#" class="sidebar-link">
                        <i class="bi bi-people-fill"></i>
                        <span>Users</span>
                    </a>
                    <ul class="submenu" style="display: none;">
                        <li class="submenu-item">
                            <a href="{% url 'active-users' %}">Active Users</a>
                        </li>
                        <li class="submenu-item">
                            <a href="{% url 'blocked-users' %}">Blocked Users</a>
                        </li>
                    <li class="submenu-item">
                        <a href="{% url 'manage-users' %}">Manage Users</a>
                    </li>
                    </ul>
                </li>
                {% endif %}
                <li class="sidebar-item  has-sub active">
                    <a href="#" class="sidebar-link">
                        <i class="bi bi-pie-chart-fill"></i>
                        <span>Reports</span>
                    </a>
                    <ul class="submenu ">
                        <li class="submenu-item active">
                            <a href="{% url 'sex-report' %}">Gender Report</a>
                        </li>
                        <li class="submenu-item ">
                            <a href="{% url 'brgy-report' %}">Barangay Report</a>
                        </li>
                        <li class="submenu-item">
                            <a href="{% url 'status-report' %}">Status Report</a>
                        </li>
                    </ul>
                </li>

            
                <hr>
                {% if user.is_authenticated %}
                <li class="sidebar-item">
                     <a href="{% url 'logout' %}" class="sidebar-link" onclick="return confirm('Logout?')">
                        <i class="bi bi-window close-fill"></i>
                        <span class="text-danger">Logout</span>
                    </a>
                </li>
                {% endif %}

                
            </ul>
        </div>
    </div>
<div class="page-heading">
    <div class="page-title">
        <div class="row">
            <div class="col-12 col-md-6 order-md-1 order-last">
                <h3>Gender Report</h3>
                <p>Report by gender</p>
            </div>
            <div class="col-12 col-md-6 order-md-2 order-first">
                <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Age Reports</li>
                    </ol>
                    <div class="col-md-12 offset-md-10 mt-1">
                        <button onclick="printDiv('printableArea')" class="btn btn-secondary" data-bs-toggle="tooltip" data-bs-placement="top"
                        title="Print"><i class="bi bi-printer"></i></button>
                    </div>
                </nav>
            </div>
        </div>
    </div>
    <section class="section mt-3">
        <div class="row">
            <div class="col-md-4">
                <div class="card" id="printableArea">
                    <div class="card-header">
                    </div>
                    <div class="card-body">
                    </div>
                    <!-- table striped -->
                    <div class="table-responsive">
                        <table class="table table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>Gender</th>
                                    <th>Number</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background-color:#2EBCFE; color: white;">
                                    <td class="text-bold-500">Male</td>
                                    <td>{{male}}</td>
                                </tr>
                                <tr style="background-color:#FE2EC3; color: white;">
                                    <td class="text-bold-500">Female</td>
                                    <td>{{ female }}</td>
                                </tr>
                                <tr>
                                    <td class="text-bold-500">Total</td>
                                    <td>{{ total }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
        <div class="col-md-7">
        <div class="card">
            <div class="card-header">
            </div>
            <div class="card-body">
                                    
                                    <!-- table striped -->
                                    <div id="container" style="width: 90%;">
                                        <canvas id="pie-chart"></canvas>
                                      </div>
                                    
                                      <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
                                      <script>
                                    
                                        var config = {
                                          type: 'doughnut',
                                          data: {
                                            datasets: [{
                                              data: {{ data|safe }},
                                              backgroundColor: [
                                                '#2EBCFE', '#FE2EC3', '#A9A9A9', '#C0C0C0', '#D3D3D3'
                                              ],
                                              label: 'Gender'
                                            }],
                                            labels: {{ labels|safe }}
                                          },
                                          options: {
                                            responsive: true
                                          }
                                        };
                                    
                                        window.onload = function() {
                                          var ctx = document.getElementById('pie-chart').getContext('2d');
                                          window.myPie = new Chart(ctx, config);
                                        };
                                    
                                      </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                {% comment %} {% for member in total_members %}
                    {{ member.age }}
                {% endfor %} {% endcomment %}

            </div>
        </div>
    </div>
    </section>
</div>


{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{% static 'vendors/simple-datatables/style.css' %}">
{% endblock %}
{% block js %}
<script src="{% static 'vendors/simple-datatables/simple-datatables.js' %}"></script>
<script>
    // Simple Datatable
    let table1 = document.querySelector('#table1');
    let dataTable = new simpleDatatables.DataTable(table1);
    function printDiv(divName){
        var printContents = document.getElementById(divName).innerHTML;
        var originalContents = document.body.innerHTML;
    
        document.body.innerHTML = printContents;
    
        window.print();
    
        document.body.innerHTML = originalContents;
    
        }
        function htmlToCSV(html, filename) {
            var data = [];
            var rows = document.querySelectorAll("table tr");
        
            for (var i = 0; i < rows.length; i++) {
                var row = [],
                    cols = rows[i].querySelectorAll("td, th");
        
                for (var j = 0; j < cols.length; j++) {
                    row.push(cols[j].innerText);
                }
        
                data.push(row.join(","));
            }
        
            downloadCSVFile(data.join("\n"), filename);
        }
        
        function downloadCSVFile(csv, filename) {
            var csv_file, download_link;
        
            csv_file = new Blob([csv], {type: "text/csv"});
        
            download_link = document.createElement("a");
        
            download_link.download = filename;
        
            download_link.href = window.URL.createObjectURL(csv_file);
        
            download_link.style.display = "none";
        
            document.body.appendChild(download_link);
        
            download_link.click();
        }
        
        document.getElementById("download-button").addEventListener("click", function () {
            var html = document.querySelector("table").outerHTML;
            htmlToCSV(html, "seniorcitizen.csv");
        });
        
        function demoFromHTML() {
            var pdf = new jsPDF('p', 'pt', 'letter');
            source = $('#table1')[0];
            specialElementHandlers = {
                // element with id of "bypass" - jQuery style selector
                '#bypassme': function (element, renderer) {
                    // true = "handled elsewhere, bypass text extraction"
                    return true
                }
            };
            margins = {
                top: 80,
          
                bottom: 60,
                left: 40,
                width: 522
            };
            // all coords and widths are in jsPDF instance's declared units
            // 'inches' in this case
            pdf.fromHTML(
            source, // HTML string or DOM elem ref.
            margins.left, // x coord
            margins.top, { // y coord
                'width': margins.width, // max width of content on PDF
                'elementHandlers': specialElementHandlers
            },
        
            function (dispose) {
                // dispose: object with X, Y of the last line add to the PDF 
                //          this allow the insertion of new lines after html
                pdf.save('Test.pdf');
            }, margins);
        }
</script>
{% endblock %}