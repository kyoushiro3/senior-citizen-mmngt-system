{% extends 'user/layouts/master.html' %}
{% block content %}
{% load static %}

<style>
  .help-block {
      color: red;
  }
  .asteriskField {
      color: red;
  }

  .errorlist {
      color: red;
  }

  .card {
      box-shadow: 0 0.15rem 1.75rem 0 rgb(33 40 50 / 15%);
  }

  .card .card-header {
      font-weight: 500;
  }

  .card-header:first-child {
      border-radius: 0.35rem 0.35rem 0 0;
  }

  .card-header {
      padding: 1rem 1.35rem;
      margin-bottom: 0;
      background-color: rgba(39, 40, 50, 0.03);
      border-bottom: 1px solid rgba(33, 40, 50, 0.125);
  }

  .form-control,
  .dataTable-input {
      display: block;
      width: 100%;
      padding: 0.875rem 1.125rem;
      font-size: 0.875rem;
      font-weight: 400;
      line-height: 1;
      color: #69707a;
      background-color: #fff;
      background-clip: padding-box;
      border: 1px solid #c5ccd6;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      border-radius: 0.35rem;
      transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  }
</style> 
<!-- side bar -->
<div id="sidebar" class="active">
    <div class="sidebar-wrapper active ps ps--active-y">
        <div class="sidebar-header">
            <div class="d-flex justify-content-between">
                <div class="logo mb-3">
                        <a href="#"><img src="{% static 'images/logo/logooo.png' %}" style="width:auto; height:200px"alt="Logo"></a>
                </div>
                <div class="toggler">
                    <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                </div>
            </div>
        </div>
        <div class="sidebar-menu">
            <ul class="menu">
                <li class="sidebar-title">Menu</li>

                <li class="sidebar-item">
                    <a href="{% url 'index' %}" class="sidebar-link">
                        <i class="bi bi-grid-fill"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                {% if user.is_staff %}
                <li class="sidebar-item has-sub">
                    <a href="#" class="sidebar-link">
                        <i class="bi bi-people-fill"></i>
                        <span>Members</span>
                    </a>
                    <ul class="submenu" style="display: none;">
                        <li class="submenu-item">
                            <a href="{% url 'add-member' %}">Add Member</a>
                        </li>
                        
                        <li class="submenu-item">
                            <a href="{% url 'all-members' %}">All Members</a>
                        </li>
                        <li class="submenu-item">
                            <a href="{% url 'member-requests' %}">Member Requests</a>
                        </li>
                        <li class="submenu-item">
                            <a href="{% url 'manage-members' %}">Manage Members</a>
                        </li>
                    </ul>
                </li>
{% endif %}
                {% if user.is_superuser %}
                <li class="sidebar-item has-sub">
                    <a href="#" class="sidebar-link">
                        <i class="bi bi-people-fill"></i>
                        <span>Users</span>
                    </a>
                    <ul class="submenu" style="display: none;">
                        <li class="submenu-item">
                            <a href="{% url 'active-users' %}">Active Users</a>
                        </li>
                        <li class="submenu-item">
                            <a href="{% url 'blocked-users' %}">Blocked Users</a>
                        </li>
                    <li class="submenu-item">
                        <a href="{% url 'manage-users' %}">Manage Users</a>
                    </li>
                    </ul>
                </li>
{% endif %}
                <li class="sidebar-item  has-sub active">
                    <a href="#" class="sidebar-link">
                        <i class="bi bi-pie-chart-fill"></i>
                        <span>Reports</span>
                    </a>
                    <ul class="submenu ">
                        <li class="submenu-item ">
                            <a href="{% url 'sex-report' %}">Gender Report</a>
                        </li>
                        <li class="submenu-item">
                            <a href="{% url 'brgy-report' %}">Barangay Report</a>
                        </li>
                        <li class="submenu-item active">
                            <a href="{% url 'status-report' %}">Status Report</a>
                        </li>
                    </ul>
                        <hr>
                        {% if user.is_authenticated %}
                        <li class="sidebar-item">
                             <a href="{% url 'logout' %}" class="sidebar-link" onclick="return confirm('Logout?')">
                                <i class="bi bi-window close-fill"></i>
                                <span class="text-danger">Logout</span>
                            </a>
                        </li>
                        {% endif %}
        
                        
                    </ul>
        </div>
</div>
<div class="page-heading">
    <div class="page-title">
        <div class="row">
            <div class="col-12 col-md-6 order-md-1 order-last">
                <h3>Status Report</h3>
            </div>
            <div class="col-12 col-md-6 order-md-2 order-first">
                <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Status Report</li>
                    </ol>
                    <div class="col-md-12 offset-md-10 mt-1">
                        <button onclick="printDiv('printableArea')" class="btn btn-secondary" data-bs-toggle="tooltip" data-bs-placement="top"
                        title="Print"><i class="bi bi-printer"></i></button>
                    </div>
                </nav>
            </div>
        </div>
    </div>
    <section class="section mt-3">
        
        <div class="row">
        <div class="col-md-6">
        <div class="card">
            <div class="card-header">
              Graphical Representation of Member Status
            </div>
            <div class="card-body">
                                    <!-- table striped -->
                                    <div id="container" style="width: 80%;">
                                        <canvas id="pie-chart"></canvas>
                                      </div>
                                    
                                      <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
                                      <script>
                                    
                                        var config = {
                                          type: 'bar',
                                          data: {
                                            datasets: [{
                                              data: {{ data|safe }},
                                              
                                              backgroundColor: [
                                                'green', 'red'
                                              ],
                                              label: 'No. of members'
                                            }],
                                            
                                            labels: {{ labels|safe }}
                                          },
                                          options: {
                                            responsive: true
                                          }
                                        };
                                    
                                        window.onload = function() {
                                          var ctx = document.getElementById('pie-chart').getContext('2d');
                                          window.myPie = new Chart(ctx, config);
                                        };
                                    
                                      </script>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                              
                            </div>
                            <div class="card-body" id="printableArea">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Gender</th>
                                                <th>Number</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="text-bold-500">Active</td>
                                                <td>{{ Active }}</td>
                                            </tr>
                                            <tr>
                                                <td class="text-bold-500">Inactive</td>
                                                <td>{{ Inactive }}</td>
                                            </tr>
                                            <tr style="background-color: #607080; color: white;">
                                                <td class="text-bold-500">Total</td>
                                                <td>{{ total }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                </section>
     
{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{% static 'vendors/simple-datatables/style.css' %}">
{% endblock %}
{% block js %}
<script src="{% static 'vendors/simple-datatables/simple-datatables.js' %}"></script>
<script>
    // Simple Datatable
    let table1 = document.querySelector('#table1');
    let dataTable = new simpleDatatables.DataTable(table1);

    function printDiv(divName){
        var printContents = document.getElementById(divName).innerHTML;
        var originalContents = document.body.innerHTML;
    
        document.body.innerHTML = printContents;
    
        window.print();
    
        document.body.innerHTML = originalContents;
    
        }
        function htmlToCSV(html, filename) {
            var data = [];
            var rows = document.querySelectorAll("table tr");
        
            for (var i = 0; i < rows.length; i++) {
                var row = [],
                    cols = rows[i].querySelectorAll("td, th");
        
                for (var j = 0; j < cols.length; j++) {
                    row.push(cols[j].innerText);
                }
        
                data.push(row.join(","));
            }
        
            downloadCSVFile(data.join("\n"), filename);
        }
        
        function downloadCSVFile(csv, filename) {
            var csv_file, download_link;
        
            csv_file = new Blob([csv], {type: "text/csv"});
        
            download_link = document.createElement("a");
        
            download_link.download = filename;
        
            download_link.href = window.URL.createObjectURL(csv_file);
        
            download_link.style.display = "none";
        
            document.body.appendChild(download_link);
        
            download_link.click();
        }
        
        document.getElementById("download-button").addEventListener("click", function () {
            var html = document.querySelector("table").outerHTML;
            htmlToCSV(html, "seniorcitizen.csv");
        });
        
        function demoFromHTML() {
            var pdf = new jsPDF('p', 'pt', 'letter');
            source = $('#table1')[0];
            specialElementHandlers = {
                // element with id of "bypass" - jQuery style selector
                '#bypassme': function (element, renderer) {
                    // true = "handled elsewhere, bypass text extraction"
                    return true
                }
            };
            margins = {
                top: 80,
          
                bottom: 60,
                left: 40,
                width: 522
            };
            // all coords and widths are in jsPDF instance's declared units
            // 'inches' in this case
            pdf.fromHTML(
            source, // HTML string or DOM elem ref.
            margins.left, // x coord
            margins.top, { // y coord
                'width': margins.width, // max width of content on PDF
                'elementHandlers': specialElementHandlers
            },
        
            function (dispose) {
                // dispose: object with X, Y of the last line add to the PDF 
                //          this allow the insertion of new lines after html
                pdf.save('Test.pdf');
            }, margins);
        }
</script>
{% endblock %}